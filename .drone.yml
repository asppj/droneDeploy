kind: pipeline
type: docker # exec, ssh ,kubernetes
name: default

platform:
  arch: amd64

steps:
  - name: build
    image: golang
    volumes:
      - name: deps
        path: /go
    commands:
      - go env
      - go version
      - make build
      - ls 
      - bin/runner -v
    when:                                          
      event:
      - push


  - name: scp files
    image: appleboy/drone-scp
    settings:
      host: 
        - 39.100.86.233
      username: root
      port: 22
      key: 
        from_secret: private_ssh
      // password: 
      //   from_secret: ali_password
      target: /root/deploy-droneDeploy/droneDeploy
      source: 
        - bin/runner
        - scripts/deploy.sh
    when:                                           
      event:
      - push
  - name: ssh commands
    image: appleboy/drone-ssh
    settings:
      host:
        -  www.asppj.top
      port: 22
      key: 
        from_secret: private_ssh
      script:
        - echo hello
        - echo world
        - uname -a
        - pwd
        - ls
        - ~/deploy-droneDeploy/droneDeploy/bin/runner -v
    when:                                          
      event:
      - push

    - name: publish
      image: plugins/github-release
      settings:
        api_key: 
          from_secret: github_token
        files: bin/
      when:
        event: push

  // - name: notify
  //   image: drillster/drone-email
  //   settings:
  //     port: 25
  //     from: test@test.com
  //     host: smtp.test.com
  //     username: test@test.com
  //     password:
  //       from_secret: email_password
  //     skip_verify: true
  //     recipients: [ test@test.com ]
  //     recipients_only: true
  //   when:
  //     status: [ success, changed, failure ]